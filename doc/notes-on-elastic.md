

# Elastic search
Can act as:
- search engine (full-text search, semantic search,hybrid search = full-text search, vector search)
- geospatial search
- vector database
- as RAG engine (retrieval augmented generation) to support generative AI models
- SIEM - collect, store, analyze security data
- threat hunting - search and analyze data to detect and respond to threats


## Index
Fundamental unit of storge, provide namespace, identified by unique name or alias. Collection of documents.

Document stored as JSON. Document is set of fields. contains data and metadata (system info about document)

## Mapping
is process of defining how document and its fields are stored and indexed.
fields have data types
- dynamic mapping - dt automatically detected
- explicit mapping - more control over data types
  


## Ingesting data
- timestamped 
   logs, metrics, and traces
   ingest data via:
     - elastic Agent based integration includes default ingestion rules, dashboards, and visualizations to start analyzing your data right 
     - Beats - can send data directly to elastic, agents installed on servers: eg. filebeat, auditbeat,
      functionbeat, heartbeat, metricbeat, packetbeat, 
     - logstash - open source data collection engine with real-time pipelining capabilities that supports a wide variety of data sources
- not timestamped (general content) 
  vector embeddings, website content, product catalogs

- via  Api 
https://www.elastic.co/guide/en/elasticsearch/reference/current/docs.html
   elastic client: https://www.elastic.co/guide/en/elasticsearch/client/index.html
- crawler https://github.com/elastic/crawler
- connectors https://www.elastic.co/guide/en/elasticsearch/reference/current/es-connectors.html
 connectors are focused on general content, which is non-timestamped data.


 ## Ingestion examples
 https://www.elastic.co/guide/en/cloud/current/ec-ingest-guides.html

 ## search and analyze data
 elastic as document store with search capability.
 https://www.elastic.co/guide/en/elasticsearch/reference/current/search-analyze.html

 ### Query language
 https://www.elastic.co/guide/en/elasticsearch/reference/current/search-analyze.html#search-analyze-query-languages

 - dsl https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html

searching:
- full text search - phrase and proximity queries
- keyword search - looks for exact match
- semantic search - uses sparse and dense vector search on embedding generated by elastic search
- vector seach - dense  vector search on embedding created outside elastic
- geospatial search - search for locations

# Analyze
Aggregations- primary tool to analyze data using query dsl
- aggregations: https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html
summarizes you data as statistics, analytics, metrics
eg. Whatâ€™s the average load time for my website?
Who are my most valuable customers based on transaction volume?

## Three categories of aggregation
- metrics - calculate metrics like sum, avg,..
- bucket - group document into buckets based on field, ranges, ...
- pipeline - takes input from other aggregations

## Query languages
- ES QL
- query DSL
- EQL  - event query language
- KQL - kibana
- elasticsearch SQL


## Relevance of search
- precision - want retrieved results to be perfect match even if it means less data
precision = truePositive /(truePositives + falsePositives)
what portion of returned data is releant to search query

- recall - want more data returned event if it means not perfect match
recall = truePositivese/ (truePositives + falseNegatives)
what portion of relevant data is returned in results

precision vs recall  this are fighting with each other

- ranking 
  ordering of results, most relevant at the top, less relevant at the bottom
- score
  how relevant is document to given query
  TF - term frequency
  IDF - inversed document frequency

  IDF lowers weights from TF when term appears in small num of documents
  
  # Kibana is like UI to access data in elasticsearch
  you can engage with data

  Adding data to elasticsearch via kibana - use FileDataVisualizer

  # Adding data Tutorial: 
  https://www.youtube.com/watch?v=1lUnQPWPPgQ

  dataset: 
  https://www.kaggle.com/datasets/rmisra/news-category-dataset

  - all resources: 
  https://github.com/LisaHJung/Part-2-Understanding-the-relevance-of-your-search-with-Elasticsearch-and-Kibana-?tab=readme-ov-file

  Example:
  Import data from https://www.kaggle.com/datasets/rmisra/news-category-dataset using kibana FileVisualizer in Kibana/home/ingest section/fileUpload

  indexName: news_headline

  kibana/dev_console: 
  > GET news_headline/_search

  ## Exploring data
@see runbook  


## Fine-tunning precision or recall fo a match query
precision - want less results but good matched
recall - get more results, exact match is not important

https://github.com/LisaHJung/Part-2-Understanding-the-relevance-of-your-search-with-Elasticsearch-and-Kibana-?tab=readme-ov-file#precision-and-recall